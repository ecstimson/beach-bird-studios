---
export interface Props {
  variant?: 'default' | 'transparent';
}

const { variant = 'default' } = Astro.props;

const navItems = [
  { 
    href: '/services', 
    label: 'Services',
    dropdown: [
      { href: '/services', label: 'All Services' },
      { href: '/services/custom-website-design', label: 'Custom Web Design' },
      { href: '/services/ai-website-development', label: 'AI Website Development' },
      { href: '/services/seo-services', label: 'SEO Services' },
    ]
  },
  {
    href: '/resources',
    label: 'Resources',
    dropdown: [
      { href: '/ultimate-web-design-guide', label: 'Web Design Guide' },
      { href: '/small-business-seo-guide', label: 'SEO Guide' },
      { href: '/website-cost-guide', label: 'Pricing Guide' },
      { href: '/local-seo-checklist', label: 'SEO Checklist' },
    ]
  },
  { href: '/about', label: 'About' },
  { href: '/portfolio', label: 'Portfolio' },
  { href: '/process', label: 'Process' },
  { href: '/pricing', label: 'Pricing' },
  { href: '/blog', label: 'Blog' },
];
---

<header class={`fixed top-0 left-0 right-0 ${variant === 'transparent' ? 'bg-transparent' : 'bg-surface/80 backdrop-blur-md border-b border-border'} z-50`}>
  <nav class="container mx-auto max-w-screen-xl px-4 md:px-6">
    <div class="flex justify-between items-center h-20">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/" class="block">
          <img 
            src="/images/logo.svg" 
            alt="Beach Bird Studios" 
            class="h-10 sm:h-12 w-auto"
            style="max-width: 240px;"
          />
        </a>
      </div>
      
      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-10">
        {navItems.map((item) => (
          item.dropdown ? (
            <div class="relative group">
              <button class="flex items-center text-text font-semibold hover:text-primary-400 transition-colors" aria-current={Astro.url.pathname === item.href ? 'page' : undefined}>
                {item.label}
                <i data-lucide="chevron-down" class="w-4 h-4 ml-1"></i>
              </button>
              <div class="absolute top-full left-0 mt-2 w-64 bg-elevated rounded-[var(--radius-md)] shadow-[var(--shadow-md)] border border-border opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                {item.dropdown.map((subItem) => (
                  <a 
                    href={subItem.href} 
                    class="block px-4 py-3 text-muted font-medium hover:text-primary-400 hover:bg-white/5 transition-colors first:rounded-t-[var(--radius-md)] last:rounded-b-[var(--radius-md)]"
                  >
                    {subItem.label}
                  </a>
                ))}
              </div>
            </div>
          ) : (
            <a href={item.href} class="text-text font-semibold hover:text-primary-400 transition-colors" aria-current={Astro.url.pathname === item.href ? 'page' : undefined}>
              {item.label}
            </a>
          )
        ))}
        <a href="/contact" class="inline-flex items-center gap-2 rounded-[var(--radius-md)] bg-primary-600 text-inverse px-5 py-3 font-medium shadow-[var(--shadow-sm)] hover:bg-primary-500 focus:ring-2 focus:ring-primary-400 focus:outline-none transition">Contact</a>
      </div>
      
      <!-- Mobile Menu Button -->
      <button 
        class="md:hidden p-3 rounded-[var(--radius-md)] hover:bg-white/5 transition-colors min-w-[48px] min-h-[48px] flex items-center justify-center text-text focus:ring-2 focus:ring-primary-400 focus:outline-none" 
        id="mobile-menu-button"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
      >
        <i data-lucide="menu" class="w-6 h-6"></i>
      </button>
    </div>
  </nav>
  
  <!-- Mobile Menu -->
  <div class="hidden md:hidden bg-surface/80 backdrop-blur-md border-t border-border" id="mobile-menu">
    <div class="px-4 py-2 space-y-1">
      {navItems.map((item) => (
        item.dropdown ? (
          <div>
            <button class="flex items-center justify-between w-full px-4 py-3 min-h-[48px] text-text font-semibold hover:text-primary-400 hover:bg-white/5 rounded-[var(--radius-md)] transition-colors mobile-dropdown-btn">
              {item.label}
              <i data-lucide="chevron-down" class="w-4 h-4 transition-transform"></i>
            </button>
            <div class="hidden pl-4 space-y-1 mobile-dropdown-menu">
              {item.dropdown.map((subItem) => (
                <a href={subItem.href} class="block px-4 py-3 min-h-[48px] flex items-center text-muted font-medium hover:text-primary-400 hover:bg-white/5 rounded-[var(--radius-md)] transition-colors">
                  {subItem.label}
                </a>
              ))}
            </div>
          </div>
        ) : (
          <a href={item.href} class="block px-4 py-3 min-h-[48px] flex items-center text-text font-semibold hover:text-primary-400 hover:bg-white/5 rounded-[var(--radius-md)] transition-colors" aria-current={Astro.url.pathname === item.href ? 'page' : undefined}>
            {item.label}
          </a>
        )
      ))}
      <div class="pt-2 pb-3 border-t border-border">
        <a href="/contact" class="inline-flex items-center gap-2 rounded-[var(--radius-md)] bg-primary-600 text-inverse px-5 py-3 font-medium shadow-[var(--shadow-sm)] hover:bg-primary-500 focus:ring-2 focus:ring-primary-400 focus:outline-none transition w-full justify-center">Contact</a>
      </div>
    </div>
  </div>
</header>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  
  mobileMenuButton?.addEventListener('click', () => {
    const isOpen = !mobileMenu?.classList.contains('hidden');
    mobileMenu?.classList.toggle('hidden');
    mobileMenuButton?.setAttribute('aria-expanded', (!isOpen).toString());
    
    // Animate menu icon
    const icon = mobileMenuButton?.querySelector('[data-lucide]');
    if (icon) {
      icon.setAttribute('data-lucide', isOpen ? 'menu' : 'x');
      if (typeof (window as any).lucide !== 'undefined') {
        (window as any).lucide.createIcons();
      }
    }
  });
  
  // Close mobile menu when clicking on a link
  const mobileMenuLinks = mobileMenu?.querySelectorAll('a');
  mobileMenuLinks?.forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.add('hidden');
    });
  });
  
  // Handle mobile dropdown menus
  const mobileDropdownBtns = document.querySelectorAll('.mobile-dropdown-btn');
  mobileDropdownBtns?.forEach(btn => {
    btn.addEventListener('click', () => {
      const menu = btn.nextElementSibling;
      menu?.classList.toggle('hidden');
      const icon = btn.querySelector('[data-lucide="chevron-down"]');
      if (icon) {
        (icon as HTMLElement).style.transform = menu?.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
      }
    });
  });
</script>
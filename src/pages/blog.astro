---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Hero from '../components/Hero.astro';
import BlogCard from '../components/BlogCard.astro';
import CTASection from '../components/CTASection.astro';
import Footer from '../components/Footer.astro';

const pageTitle = 'Blog | Web Design & SEO Insights | Beach Bird Studios';
const pageDescription = 'Expert insights on web design, SEO, and digital marketing. Learn how to grow your business online with proven strategies from Beach Bird Studios.';

// Get blog posts from content collection
const allBlogPosts = await getCollection('blog');

// Sort by publish date (newest first) and filter out drafts
const blogPosts = allBlogPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .map(post => ({
    title: post.data.title,
    excerpt: post.data.description,
    date: new Date(post.data.publishDate).toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    }),
    category: post.data.category || 'Web Design',
    href: `/blog/${post.slug}`,
    readTime: Math.ceil(post.body.length / 1000) + ' min read',
    image: post.data.image,
    tags: post.data.tags || []
  }));

// Extract unique categories from blog posts
const allCategories = [...new Set(blogPosts.map(post => post.category))];
const categories = ['All Posts', ...allCategories];
---

<Layout title={pageTitle} description={pageDescription}>
  <SEO title={pageTitle} description={pageDescription} />
  <Header />
  
  <main>
    <!-- Hero Section -->
    <Hero
      headline="Insights to Grow Your Business Online"
      subheadline="Expert tips, strategies, and insights on web design, SEO, and digital marketing"
      primaryCTA={{ text: 'Subscribe to Updates', href: '/contact' }}
      variant="gradient"
    />
    
    <!-- Blog Content -->
    <section class="section-padding bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Categories Filter -->
        <div id="category-filters" class="flex flex-wrap gap-3 justify-center mb-12">
          {categories.map((category) => (
            <button 
              data-category={category}
              class={`category-filter px-4 py-2 rounded-full font-medium transition-colors ${
              category === 'All Posts' 
                ? 'bg-beach-blue text-white active' 
                : 'bg-beach-cream text-beach-dark hover:bg-beach-blue hover:text-white'
            }`}>
              {category}
            </button>
          ))}
        </div>
        
        <!-- Blog Grid -->
        <div id="blog-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {blogPosts.map((post) => (
            <div data-category={post.category} class="blog-post-item">
              <BlogCard {...post} />
            </div>
          ))}
        </div>
        
        <!-- Load More -->
        <div class="text-center mt-12">
          <button class="btn-secondary">
            Load More Articles
          </button>
        </div>
      </div>
    </section>
    
    <!-- Newsletter Signup -->
    <section class="section-padding bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-2xl mx-auto text-center">
          <h2 class="text-3xl sm:text-4xl font-chillax font-bold text-beach-dark mb-4">
            Stay Ahead of the Competition
          </h2>
          <p class="text-lg text-gray-600 mb-8">
            Get weekly insights on web design, SEO, and digital marketing delivered to your inbox.
          </p>
          
          <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
            <input
              type="email"
              placeholder="Enter your email"
              class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:border-beach-blue focus:outline-none focus:ring-2 focus:ring-beach-blue/20"
              required
            />
            <button type="submit" class="btn-primary">
              Subscribe
            </button>
          </form>
          
          <p class="text-sm text-gray-500 mt-4">
            No spam, unsubscribe anytime. We respect your privacy.
          </p>
        </div>
      </div>
    </section>
    
    <!-- Popular Topics -->
    <section class="section-padding bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl sm:text-4xl font-chillax font-bold text-beach-dark mb-8 text-center">
          Popular Topics
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="bg-gradient-to-br from-sky-500/10 to-sky-500/5 rounded-xl p-6">
            <h3 class="text-xl font-chillax font-semibold text-beach-dark mb-4">
              Local SEO Guides
            </h3>
            <ul class="space-y-2">
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Google Business Profile Setup
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Local Citation Building
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                NAP Consistency Guide
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Review Management
              </a></li>
            </ul>
          </div>
          
          <div class="bg-gradient-to-br from-amber-500/10 to-amber-500/5 rounded-xl p-6">
            <h3 class="text-xl font-chillax font-semibold text-beach-dark mb-4">
              Web Design Tips
            </h3>
            <ul class="space-y-2">
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Mobile-First Design
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Conversion Optimization
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Speed Optimization
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                User Experience Best Practices
              </a></li>
            </ul>
          </div>
          
          <div class="bg-gradient-to-br from-sky-50 to-white rounded-xl p-6">
            <h3 class="text-xl font-chillax font-semibold text-beach-dark mb-4">
              Digital Marketing
            </h3>
            <ul class="space-y-2">
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Content Strategy
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Email Marketing
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Social Media Tips
              </a></li>
              <li><a href="#" class="flex items-center text-gray-600 hover:text-beach-blue transition-colors">
                <i data-lucide="chevron-right" class="w-4 h-4 mr-1"></i>
                Analytics & Tracking
              </a></li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    
    <!-- CTA -->
    <CTASection
      headline="Need Help Growing Your Business Online?"
      description="Let's discuss your goals and create a strategy that works"
      primaryCTA={{ text: 'Get Free Consultation', href: '/contact' }}
      secondaryCTA={{ text: 'View Our Services', href: '/services' }}
      variant="gradient"
    />
  </main>
  
  <Footer />
  
  <script>
    // Blog category filtering
    document.addEventListener('DOMContentLoaded', () => {
      const filterButtons = document.querySelectorAll('.category-filter');
      const blogPosts = document.querySelectorAll('.blog-post-item');
      
      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          const selectedCategory = button.getAttribute('data-category');
          
          // Update active button state
          filterButtons.forEach(btn => {
            btn.classList.remove('bg-beach-blue', 'text-white', 'active');
            btn.classList.add('bg-beach-cream', 'text-beach-dark');
          });
          
          button.classList.remove('bg-beach-cream', 'text-beach-dark');
          button.classList.add('bg-beach-blue', 'text-white', 'active');
          
          // Filter blog posts
          blogPosts.forEach(post => {
            const postElement = post as HTMLElement;
            const postCategory = postElement.getAttribute('data-category');
            
            if (selectedCategory === 'All Posts' || postCategory === selectedCategory) {
              // Show post with fade in animation
              postElement.style.display = 'block';
              postElement.classList.remove('hidden');
              postElement.style.opacity = '0';
              postElement.style.transform = 'translateY(10px)';
              
              setTimeout(() => {
                postElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                postElement.style.opacity = '1';
                postElement.style.transform = 'translateY(0)';
              }, 10);
            } else {
              // Hide post with fade out animation
              postElement.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
              postElement.style.opacity = '0';
              postElement.style.transform = 'translateY(-10px)';
              
              setTimeout(() => {
                postElement.style.display = 'none';
                postElement.classList.add('hidden');
              }, 200);
            }
          });
          
          // Update URL without page reload (for better UX and tracking)
          const url = new URL(window.location.href);
          if (selectedCategory === 'All Posts') {
            url.searchParams.delete('category');
          } else if (selectedCategory) {
            url.searchParams.set('category', selectedCategory.toLowerCase().replace(' ', '-'));
          }
          window.history.pushState({}, '', url);
        });
      });
      
      // Check for category in URL on page load
      const urlParams = new URLSearchParams(window.location.search);
      const categoryParam = urlParams.get('category');
      
      if (categoryParam) {
        const formattedCategory = categoryParam.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
        const targetButton = document.querySelector(`[data-category="${formattedCategory}"]`) as HTMLButtonElement;
        if (targetButton) {
          targetButton.click();
        }
      }
    });
  </script>
</Layout>